<div align="center">

<img src="https://img.shields.io/badge/Kakebo-AI-FF6B6B?style=for-the-badge&logo=openai&logoColor=white" alt="Kakebo AI" />

# ğŸ® Kakebo AI

### *Tu asistente financiero personal con IA que aprende de ti*

<p align="center">
  <img src="https://img.shields.io/badge/Next.js-14-black?style=flat-square&logo=next.js" alt="Next.js" />
  <img src="https://img.shields.io/badge/TypeScript-5.0-blue?style=flat-square&logo=typescript" alt="TypeScript" />
  <img src="https://img.shields.io/badge/OpenAI-GPT--4o--mini-412991?style=flat-square&logo=openai" alt="OpenAI" />
  <img src="https://img.shields.io/badge/Supabase-PostgreSQL-3ECF8E?style=flat-square&logo=supabase" alt="Supabase" />
  <img src="https://img.shields.io/badge/License-Proprietary-red?style=flat-square" alt="License" />
</p>

<p align="center">
  <a href="#-caracterÃ­sticas"><strong>CaracterÃ­sticas</strong></a> Â·
  <a href="#-demo"><strong>Demo</strong></a> Â·
  <a href="#-quick-start"><strong>Quick Start</strong></a> Â·
  <a href="#-documentaciÃ³n"><strong>Docs</strong></a> Â·
  <a href="#-freemium-model"><strong>Pricing</strong></a>
</p>

</div>

---

## ğŸŒ¸ Â¿QuÃ© es Kakebo?

**Kakebo** es una aplicaciÃ³n moderna de gestiÃ³n financiera inspirada en el mÃ©todo japonÃ©s tradicional, pero potenciada con **Inteligencia Artificial de Ãºltima generaciÃ³n**.

A diferencia de otras apps financieras, Kakebo AI:

- ğŸ§  **Aprende de ti**: Se vuelve mÃ¡s inteligente con cada interacciÃ³n
- ğŸ’¬ **Habla tu idioma**: Consultas en lenguaje natural, sin jerga tÃ©cnica
- ğŸ¯ **Se adapta**: Ajusta su comportamiento segÃºn la calidad de tus datos
- ğŸŒ **Aprende globalmente**: Se beneficia del conocimiento compartido de todos los usuarios (respetando tu privacidad)

---

## âœ¨ CaracterÃ­sticas

### ğŸ¤– Kakebo Copilot - Tu Asistente Financiero Proactivo

<details>
<summary><b>Chat conversacional + Acciones automÃ¡ticas</b></summary>

**El Copilot no solo responde, Â¡ACTÃšA!** Gestiona tus finanzas conversacionalmente:

```
ğŸ‘¤ "Registra 50â‚¬ de comida"
ğŸ¤– "Â¿Quieres que registre un gasto de 50â‚¬ en supervivencia con concepto 'comida'?"
ğŸ‘¤ "SÃ­"
ğŸ¤– "âœ… Registrado: Gasto de 50â‚¬ en supervivencia - 'comida'"

ğŸ‘¤ "Cambia el Ãºltimo gasto a 45â‚¬"
ğŸ¤– "Â¿Cambio el importe de 50â‚¬ a 45â‚¬?"
ğŸ‘¤ "SÃ­"
ğŸ¤– "âœ… Actualizado: importe modificado"

ğŸ‘¤ "Quiero ahorrar 1200â‚¬ para vacaciones en agosto"
ğŸ¤– "Â¿Confirmas escenario 'Vacaciones Agosto' (1200â‚¬, categorÃ­a opcional)?"
ğŸ‘¤ "SÃ­"
ğŸ¤– "âœ… Escenario creado. Necesitas ahorrar 200â‚¬/mes durante 6 meses"

ğŸ‘¤ "Establece el presupuesto de ocio en 300â‚¬"
ğŸ¤– "âœ… Presupuesto actualizado: opcional = 300â‚¬"
```

**Powered by GPT-4o-mini con Function Calling + 12 herramientas especializadas**

</details>

<details>
<summary><b>Sistema de aprendizaje (Personal + Global)</b></summary>

Kakebo AI **aprende permanentemente**:

1. **Feedback Personal**: Corrige cualquier resultado y el AI lo recuerda para siempre
2. **Consenso Global**: Si 3+ usuarios corrigen lo mismo, todos se benefician
3. **BÃºsqueda SemÃ¡ntica**: Encuentra conceptos relacionados aunque uses palabras diferentes

**Ejemplo de aprendizaje colectivo:**
```
7 usuarios: "insulina" = NO es vicio
3 usuarios: "insulina" = SÃ­ es vicio
â†’ 70% consenso â†’ Marcado globalmente como NO vicio
```

**Privacidad garantizada**: Solo se comparte el patrÃ³n (ej: "X NO es Y"), nunca tus datos personales.

</details>

<details>
<summary><b>AnÃ¡lisis avanzado + GestiÃ³n proactiva</b></summary>

**Lectura (AnÃ¡lisis):**
- ğŸ“Š **Patrones de gasto**: Identifica tendencias por categorÃ­a
- ğŸ”® **Predicciones**: Proyecta cuÃ¡nto gastarÃ¡s al final del mes
- âš ï¸ **DetecciÃ³n de anomalÃ­as**: Te avisa de gastos inusuales
- ğŸ“ˆ **Trends histÃ³ricos**: Compara con meses anteriores
- ğŸ” **BÃºsqueda semÃ¡ntica**: Encuentra gastos por concepto

**Escritura (Acciones):**
- âœï¸ **Crear transacciones**: Registra gastos/ingresos por chat
- ğŸ”„ **Modificar transacciones**: Corrige importes, categorÃ­as, conceptos
- ğŸ¯ **Planificar escenarios**: Calcula ahorro necesario para objetivos futuros
- ğŸ’° **Configurar presupuestos**: Ajusta lÃ­mites conversacionalmente
- ğŸ“… **Ciclos personalizados**: Soporte para nÃ³mina-a-nÃ³mina (no solo meses calendario)

</details>

### ğŸ’° GestiÃ³n Financiera Avanzada

- âœ… **CategorÃ­as Kakebo** autÃ©nticas: Supervivencia, Opcional, Cultura, Extra
- ğŸ“… **Ciclos de pago personalizados**: NÃ³mina-a-nÃ³mina o calendario estÃ¡ndar
- ğŸ’³ **Tracking de gastos** rÃ¡pido y visual + Registro por chat
- ğŸ¯ **Presupuestos por ciclo**: HistÃ³rico de presupuestos con tracking evolutivo
- ğŸ’¸ **GestiÃ³n de MÃºltiples Ingresos**: Registro detallado de nÃ³minas, extras y regalos
- ğŸ”” **Alertas configurables**: Umbrales personalizables por categorÃ­a (warning/critical)
- ğŸ“ **Reflexiones Kakebo**: Sistema de reflexiÃ³n mensual con action items
- ğŸ² **Escenarios What-If**: Planifica gastos futuros con cÃ¡lculo automÃ¡tico de ahorro

### ğŸ“„ Reportes Premium

- ğŸ“‘ **PDF profesionales** con grÃ¡ficos
- ğŸ“Š **AnÃ¡lisis detallado** por periodo
- ğŸ’¾ **ExportaciÃ³n** de datos

### ğŸ¨ DiseÃ±o Wabi-Sabi

- ğŸŒ¸ EstÃ©tica zen inspirada en JapÃ³n
- ğŸŒ“ **Modo oscuro** perfecto
- ğŸ“± **Responsive** (mÃ³vil, tablet, desktop)
- âš¡ **RÃ¡pido** y fluido

---

## ğŸ¬ Demo

> ğŸš§ **Screenshots en desarrollo**  
> Muy pronto aÃ±adiremos capturas del dashboard, chat AI, y reportes.

**Live Demo**: [kakebo-app.vercel.app](https://kakebo-app.vercel.app) *(pending)*

---

## ğŸš€ Quick Start

### Prerrequisitos

```bash
Node.js â‰¥ 18.0.0
npm â‰¥ 9.0.0
```

### InstalaciÃ³n en 3 pasos

```bash
# 1. Clonar el repositorio
git clone https://github.com/mrsteppenwolf627/kakebo.git
cd kakebo

# 2. Instalar dependencias
npm install

# 3. Configurar variables de entorno
cp .env.example .env.local
# Edita .env.local con tus keys (ver abajo)

# 4. Ejecutar en desarrollo
npm run dev
```

Abre [http://localhost:3000](http://localhost:3000) ğŸ‰

### âš™ï¸ Variables de Entorno

Crea `.env.local` con:

```env
# Supabase (Database + Auth)
NEXT_PUBLIC_SUPABASE_URL=https://tu-proyecto.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=tu_anon_key
SUPABASE_SERVICE_ROLE_KEY=tu_service_role_key

# OpenAI (AI Agent)
OPENAI_API_KEY=sk-proj-...

# Stripe (Pagos)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PRICE_ID_PRO=price_...
STRIPE_WEBHOOK_SECRET=whsec_...
NEXT_PUBLIC_PRICE_DISPLAY=3.99â‚¬

# Admin
NEXT_PUBLIC_ADMIN_EMAILS=tu-email@ejemplo.com

# App
NEXT_PUBLIC_APP_URL=http://localhost:3000
USE_FUNCTION_CALLING_AGENT=true
```

**GuÃ­as**:
- [Configurar Supabase](#-supabase-setup)
- [Configurar Stripe](#-stripe-setup)
- [Obtener OpenAI API Key](https://platform.openai.com/api-keys)

---

## ğŸ’ Freemium Model

### ğŸ†“ Tier Gratis

**Para siempre gratis**, incluye:

- âœ… Tracking de gastos ilimitado
- âœ… Dashboard con grÃ¡ficos
- âœ… Vista calendario
- âœ… Presupuestos por categorÃ­a
- âœ… CategorizaciÃ³n manual

### â­ Tier Premium â€” **â‚¬3.99/mes**

Desbloquea:

- ğŸ¤– **Chat AI ilimitado** con el agente inteligente
- âœ¨ **ClasificaciÃ³n automÃ¡tica** de gastos con IA
- ğŸ“„ **Reportes PDF** profesionales
- ğŸ”® **AnÃ¡lisis predictivo** avanzado
- ğŸ¯ **DetecciÃ³n de anomalÃ­as**
- ğŸŒ **Aprendizaje global** de la comunidad

**ğŸ’ Trial de 15 dÃ­as** al suscribirte via Stripe

### ğŸ VIP Access

Acceso premium manual para:
- ğŸ‘¥ Beta testers
- â¤ï¸ Amigos y familia
- ğŸ› ï¸ Contributors

*Contacta al admin para solicitar acceso VIP*

---

## ğŸ› ï¸ Tech Stack

<table>
<tr>
<td valign="top" width="50%">

### Frontend

- âš¡ **Next.js 14** (App Router)
- âš›ï¸ **React 18**
- ğŸ”· **TypeScript**
- ğŸ¨ **Tailwind CSS**
- ğŸ“Š **Recharts**
- ğŸ“„ **React-PDF Renderer**

</td>
<td valign="top" width="50%">

### Backend

- ğŸŸ¢ **Next.js API Routes**
- ğŸ˜ **PostgreSQL** (Supabase)
- ğŸ” **Supabase Auth**
- ğŸ’³ **Stripe** (pagos)
- ğŸ§  **OpenAI API** (GPT-4o-mini)
- ğŸ” **pgvector** (embeddings)

</td>
</tr>
</table>

### ğŸ¤– AI Architecture (v3 - Copilot)

- **Model**: GPT-4o-mini con Function Calling
- **Agent Type**: Proactive Copilot (no solo analista)
- **Herramientas**: 12 tools (7 read + 5 write)
  - Read: analyzeSpending, budgetStatus, anomalies, predictions, trends, search, feedback
  - Write: createTransaction, updateTransaction, calculateWhatIf, setBudget, getCurrentCycle
- **Embeddings**: text-embedding-3-small (1536 dims)
- **Vector Store**: PostgreSQL + pgvector
- **Learning**: Feedback hÃ­brido (personal + global consensus)
- **ConfirmaciÃ³n**: Todas las acciones de escritura requieren confirmaciÃ³n explÃ­cita del usuario

---

## ğŸ“– DocumentaciÃ³n

### ğŸ“š GuÃ­as Principales

- [ğŸ“˜ Arquitectura del Sistema](CONTEXT.md) - Overview completo
- [ğŸš€ Deployment Guide](docs/DEPLOYMENT_GUIDE.md) - Deploy a producciÃ³n
- [ğŸ§ª Testing Guide](docs/MANUAL_TESTING_GUIDE.md) - Testing manual

### ğŸ¤– Kakebo Copilot (v3)

- [ğŸ® GuÃ­a de MigraciÃ³n](KAKEBO_COPILOT_MIGRATION_GUIDE.md) - Migraciones de base de datos
- [ğŸ› ï¸ GuÃ­a de ImplementaciÃ³n](KAKEBO_COPILOT_IMPLEMENTATION.md) - Arquitectura Copilot
- [ğŸ§  AI Agent Architecture](docs/KAKEBOT_V2_ARCHITECTURE.md) - CÃ³mo funciona el agente
- [ğŸ“¡ API Documentation](docs/API_DOCUMENTATION.md) - Endpoints y ejemplos
- [ğŸ”„ Learning System](CONTEXT.md#learning-system-architecture) - Sistema de aprendizaje

### ğŸ’° SaaS & Freemium

- [ğŸ’ Freemium Setup](#-freemium-model) - ConfiguraciÃ³n de tiers
- [ğŸ’³ Stripe Integration](stripe_setup_guide.md) - Configurar pagos
- [ğŸ‘‘ Admin Panel](#-admin-panel) - GestiÃ³n de VIPs

---

## ğŸ—ï¸ Estructura del Proyecto

```
kakebo/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (landing)/            # Landing page
â”‚   â”‚   â”œâ”€â”€ app/                  # App dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/            # Admin panel (VIP grants)
â”‚   â”‚   â”‚   â”œâ”€â”€ agent/            # AI Chat page
â”‚   â”‚   â”‚   â””â”€â”€ new/              # Create expense
â”‚   â”‚   â””â”€â”€ api/
â”‚   â”‚       â”œâ”€â”€ ai/               # AI endpoints
â”‚   â”‚       â”œâ”€â”€ admin/            # Admin APIs
â”‚   â”‚       â”œâ”€â”€ stripe/           # Stripe integration
â”‚   â”‚       â””â”€â”€ webhooks/         # Stripe webhooks
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ agents-v2/            # AI Agent (v2 - current)
â”‚   â”‚   â”‚   â”œâ”€â”€ function-caller.ts     # Orchestrator
â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.ts             # System prompts
â”‚   â”‚   â”‚   â””â”€â”€ tools/                 # Tool definitions + executor
â”‚   â”‚   â”œâ”€â”€ agents/               # Tool implementations
â”‚   â”‚   â”‚   â””â”€â”€ tools/
â”‚   â”‚   â”‚       â”œâ”€â”€ search-expenses.ts      # Semantic search
â”‚   â”‚   â”‚       â”œâ”€â”€ feedback.ts             # Learning system
â”‚   â”‚   â”‚       â”œâ”€â”€ spending-analysis.ts    # AnÃ¡lisis de gastos
â”‚   â”‚   â”‚       â”œâ”€â”€ predictions.ts          # Predicciones
â”‚   â”‚   â”‚       â”œâ”€â”€ trends.ts               # Tendencias
â”‚   â”‚   â”‚       â”œâ”€â”€ create-transaction.ts   # Crear gastos/ingresos (v3)
â”‚   â”‚   â”‚       â”œâ”€â”€ update-transaction.ts   # Modificar transacciones (v3)
â”‚   â”‚   â”‚       â”œâ”€â”€ calculate-whatif.ts     # Escenarios financieros (v3)
â”‚   â”‚   â”‚       â”œâ”€â”€ set-budget.ts           # Configurar presupuestos (v3)
â”‚   â”‚   â”‚       â””â”€â”€ get-current-cycle.ts    # Info de ciclo actual (v3)
â”‚   â”‚   â”œâ”€â”€ ai/                   # AI utilities
â”‚   â”‚   â”‚   â””â”€â”€ embeddings.ts     # OpenAI embeddings
â”‚   â”‚   â”œâ”€â”€ auth/                 # Auth & Access Control
â”‚   â”‚   â”‚   â””â”€â”€ access-control.ts # Premium access logic
â”‚   â”‚   â””â”€â”€ supabase/             # Supabase clients
â”‚   â”‚       â”œâ”€â”€ client.ts         # Browser client
â”‚   â”‚       â”œâ”€â”€ server.ts         # Server client
â”‚   â”‚       â””â”€â”€ admin.ts          # Admin client (service role)
â”‚   â”œâ”€â”€ components/               # React components
â”‚   â”‚   â”œâ”€â”€ saas/                 # Freemium components
â”‚   â”‚   â”‚   â”œâ”€â”€ SubscriptionGuard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ PremiumPrompt.tsx
â”‚   â”‚   â””â”€â”€ reports/              # PDF reports
â”‚   â”‚       â”œâ”€â”€ ReportDialog.tsx
â”‚   â”‚       â””â”€â”€ ReportPDF.tsx
â”‚   â””â”€â”€ __tests__/                # Tests (99 tests totales)
â”‚       â”œâ”€â”€ agents-v2/            # 40 tests (agent core)
â”‚       â””â”€â”€ agents/tools/         # 59 tests (CRUD tools v3)
â”œâ”€â”€ supabase/                     # Database migrations
â”‚   â””â”€â”€ migrations/
â”œâ”€â”€ docs/                         # Documentation
â””â”€â”€ .env.local                    # Environment variables (not in git)
```

---

## ğŸ“Š Scripts Disponibles

```bash
# Desarrollo
npm run dev              # Dev server (port 3000)
npm run build            # Build producciÃ³n
npm run start            # Start production server

# Testing
npm test                 # Run tests
npm test -- agents-v2 --run   # Test AI agent

# Linting
npm run lint             # Check code quality

# Database
npm run db:push          # Push schema changes to Supabase
npm run db:migrate       # Run migrations
```

---

## ğŸ” ConfiguraciÃ³n de Servicios

### ğŸ—„ï¸ Supabase Setup

1. Crea proyecto en [supabase.com](https://supabase.com)
2. Habilita extensiÃ³n `pgvector` en SQL Editor:
   ```sql
   CREATE EXTENSION IF NOT EXISTS vector;
   ```
3. Ejecuta las migraciones SQL **EN ORDEN**:

   **Base (SaaS):**
   - `supabase_migration_saas.sql` (profiles + SaaS)
   - `search_feedback_migration.sql` (learning system)
   - `update_trigger_to_free.sql` (free tier por defecto)

   **Copilot (v3 - NUEVO):**
   - `supabase_migration_payment_cycles.sql` (ciclos personalizados)
   - `supabase_migration_cycle_budgets.sql` (presupuestos por ciclo)
   - `supabase_migration_alert_settings.sql` (alertas configurables)
   - `supabase_migration_kakebo_reflections.sql` (reflexiones Kakebo)
   - `supabase_migration_financial_scenarios.sql` (planificaciÃ³n what-if)
   - `supabase_migration_deprecate_user_settings.sql` (deprecaciÃ³n)

4. Verifica con: `verify_migrations.sql`
5. Copia las keys de Settings â†’ API

**Ver guÃ­a completa**: [KAKEBO_COPILOT_MIGRATION_GUIDE.md](KAKEBO_COPILOT_MIGRATION_GUIDE.md)

### ğŸ’³ Stripe Setup

1. Crea cuenta en [stripe.com](https://stripe.com)
2. Crea producto "Kakebo Premium": â‚¬3.99/mes con trial de 15 dÃ­as
3. Configura webhook endpoint: `/api/webhooks/stripe`
   - Eventos: `checkout.session.completed`, `customer.subscription.deleted`
4. Copia Price ID y keys

**Ver guÃ­a detallada**: [stripe_setup_guide.md](stripe_setup_guide.md)

### ğŸ¤– OpenAI Setup

1. ObtÃ©n API key en [platform.openai.com](https://platform.openai.com/api-keys)
2. AÃ±ade a `.env.local`
3. **Costo estimado**: ~$0.002-0.005 por conversaciÃ³n

---

## ğŸ‘‘ Admin Panel

Accede a `/app/admin` para:

- âœ… Otorgar acceso VIP manual
- âŒ Revocar acceso VIP
- ğŸ“‹ Ver lista de usuarios VIP

**ConfiguraciÃ³n**:
```env
NEXT_PUBLIC_ADMIN_EMAILS=tu-email@ejemplo.com,otro@ejemplo.com
```

Requiere `SUPABASE_SERVICE_ROLE_KEY` para funcionar.

---

## ğŸ§ª Testing

```bash
# Run all tests
npm test

# Run specific test suites
npm test -- agents-v2           # Agent core tests
npm test -- create-transaction  # CRUD tools tests
npm test -- update-transaction
npm test -- calculate-whatif
npm test -- set-budget
npm test -- get-current-cycle

# Expected: 99/99 tests passing âœ“
```

**Coverage:**
- âœ… Agent v2 core (40 tests)
  - Function caller (15 tests)
  - Hardening integration (10 tests)
  - Sprint 2 features (15 tests)
- âœ… CRUD Tools (59 tests) **NUEVO**
  - create-transaction (10 tests)
  - update-transaction (14 tests)
  - calculate-whatif (12 tests)
  - set-budget (12 tests)
  - get-current-cycle (11 tests)

---

## ğŸ“ˆ Performance

| Metric | Value |
|--------|-------|
| **AI Response Time** | < 2.5s (p95) |
| **Cost per 1K queries** | < $5 |
| **Error Rate** | < 1% |
| **LLM Calls per query** | 1-2 (40-60% faster than v1) |

---

## ğŸŒ Roadmap

### âœ… Completado

**v3.0 - Kakebo Copilot:**
- [x] TransformaciÃ³n de Analyst a Copilot proactivo
- [x] 5 herramientas CRUD (crear, modificar, planificar, configurar)
- [x] 6 migraciones de base de datos
- [x] Ciclos de pago personalizados (nÃ³mina-a-nÃ³mina)
- [x] Presupuestos por ciclo con histÃ³rico
- [x] Sistema de reflexiones Kakebo
- [x] PlanificaciÃ³n de escenarios what-if
- [x] 99 tests unitarios con 100% cobertura

**v2.x - Base AI:**
- [x] Modelo freemium con Stripe
- [x] AI Agent v2 con Function Calling
- [x] Sistema de aprendizaje (personal + global)
- [x] Admin panel para VIP grants
- [x] Reportes PDF
- [x] BÃºsqueda semÃ¡ntica
- [x] Modo oscuro Wabi-Sabi

### ğŸš§ En progreso

- [x] Testing en producciÃ³n (v3 Copilot) - **3 bugs crÃ­ticos resueltos**
- [ ] Stripe webhooks en producciÃ³n
- [ ] Screenshots para README
- [ ] Tests E2E completos
- [ ] ValidaciÃ³n completa de las 5 herramientas CRUD

### ğŸ”® Futuro

- [ ] Interfaz web para reflexiones Kakebo
- [ ] Dashboard de escenarios what-if
- [ ] ConfiguraciÃ³n de ciclos desde UI
- [ ] App mÃ³vil (React Native)
- [ ] Integraciones bancarias (Plaid)
- [ ] Multi-idioma (EN, JP)
- [ ] Consenso regional (paÃ­s/cultura)
- [ ] Confidence scores en feedback
- [ ] Analytics dashboard para admin

---

## ğŸ¤ Contribuir

Este es un proyecto privado. Para miembros del equipo:

1. Fork el repo
2. Crea una rama feature (`git checkout -b feature/amazing-feature`)
3. Commit tus cambios (`git commit -m 'Add amazing feature'`)
4. Push a la rama (`git push origin feature/amazing-feature`)
5. Abre un Pull Request

**Guidelines:**
- âœ… Tests para nuevas features
- âœ… Seguir estructura del proyecto
- âœ… Comentarios en cÃ³digo complejo
- âœ… Actualizar documentaciÃ³n

---

## ğŸ“ Changelog

### v3.1.0 (2026-02-13) - Frontend Polish & UX Improvements ğŸ¨

**Nuevas Interfaces:**
- ğŸ–¼ï¸ **Full Screen Agent**: PÃ¡gina de agente rediseÃ±ada para experiencia inmersiva (`/app/agent`).
- ğŸ’¬ **Floating Agent Chat**: Nuevo widget flotante en el dashboard para acceso rÃ¡pido al asistente.
- ğŸ”¤ **TipografÃ­a Inter**: IntegraciÃ³n de fuente `Inter` para mejor legibilidad y soporte de caracteres.

**UX Improvements:**
- ğŸ“± **Mobile Scroll Fix**: Solucionado el problema de scroll automÃ¡tico al abrir teclado en pantallas de "Nuevo Gasto/Ingreso".
- âš¡ **Animations**: Transiciones suaves aÃ±adidas con `framer-motion` para el chat flotante.

---

### v3.1.1 (2026-02-13) - SEO & Growth Update ğŸš€

**Search Engine Optimization:**
- ğŸ” **Landing Optimizada**: H1/H2 mejorados con keywords de alta intenciÃ³n ("App", "EspaÃ±a", "Gratis").
- ğŸ†š **Tabla Comparativa**: Nueva secciÃ³n "Kakebo vs Excel vs Bancos" para captar trÃ¡fico de comparaciÃ³n.
- âš¡ **Performance**: Metadatos dedicados para `/login` y estructura JSON-LD limpia.
- ğŸ—ºï¸ **Sitemap Completo**: InclusiÃ³n de pÃ¡ginas legales y configuraciÃ³n de `robots.txt` para indexaciÃ³n Ã³ptima.
- âœ… **Google Verified**: Dominio verificado en Search Console.

---

### v3.0.1 (2026-02-12) - Hotfix Critical Bugs ğŸ”¥

**ğŸ› Production Bug Fixes:**
- **CRITICAL**: Gastos creados por agente no aparecÃ­an en dashboard
  - Root cause: Dashboard filtra por `month_id`, pero agente no lo asignaba
  - Fix: `createTransaction` ahora obtiene/crea registro en `months` y asigna `month_id` + `color`
  - Impact: Gastos del agente ahora visibles en dashboard (igual que los manuales)
- **Date parsing**: LLM interpreta correctamente "de ayer", "hace 3 dÃ­as", etc.
  - Enhanced tool definition con ejemplos concretos de fechas calculadas
- **Diagnostic logging**: Logging completo del flujo de `userId` para debugging en producciÃ³n
  - Confirmado: user_id se pasa correctamente en toda la cadena

**Commits:**
- `c6175e1` - fix: assign month_id and color to agent-created expenses
- `ce00e25` - fix: improve date interpretation in createTransaction tool
- `bd0152c` - debug: add comprehensive userId tracing for createTransaction bug

**Testing:** Validado en producciÃ³n por usuario real âœ…

---

### v3.0.0 (2026-02-12) - Kakebo Copilot ğŸ¤–âœ¨

**ğŸš€ MAJOR UPGRADE - De Analyst a Copilot Proactivo**

**Nuevas Capacidades CRUD (5 herramientas):**
- âœï¸ **createTransaction** - Registra gastos/ingresos por chat
- ğŸ”„ **updateTransaction** - Modifica transacciones existentes
- ğŸ¯ **calculateWhatIf** - Planifica escenarios futuros con ahorro automÃ¡tico
- ğŸ’° **setBudget** - Configura presupuestos conversacionalmente
- ğŸ“… **getCurrentCycle** - Obtiene info del ciclo de pago actual

**Base de Datos (6 migraciones):**
- ğŸ“… **payment_cycles** - Ciclos personalizados nÃ³mina-a-nÃ³mina
- ğŸ’° **cycle_budgets** - Presupuestos por ciclo con histÃ³rico
- ğŸ”” **alert_settings** - Alertas configurables por categorÃ­a
- ğŸ“ **kakebo_reflections** - Reflexiones Kakebo con action items
- ğŸ² **financial_scenarios** - PlanificaciÃ³n what-if
- â™»ï¸ DeprecaciÃ³n de columnas antiguas en user_settings

**Testing (59 tests nuevos):**
- âœ… 99 tests totales (40 agent + 59 CRUD tools)
- âœ… 100% cobertura de nuevas herramientas
- âœ… ValidaciÃ³n completa de casos edge

**Prompt & UX:**
- ğŸ¤– TransformaciÃ³n de "Analyst" a "Copilot"
- ğŸ¯ Proactividad con confirmaciÃ³n explÃ­cita
- âœ… Feedback claro despuÃ©s de acciones
- ğŸ“š DocumentaciÃ³n completa (2 guÃ­as MD)

**Bug Fixes:**
- ğŸ› Stripe webhook type error (invoice.subscription)
- ğŸ› setBudget type error (cycleStart/cycleEnd)
- ğŸ› ValidaciÃ³n de update-transaction
- ğŸ› **CRITICAL**: Dashboard no mostraba gastos creados por agente (faltaba month_id + color)
- ğŸ› InterpretaciÃ³n incorrecta de fechas relativas ("de ayer" â†’ fecha correcta)
- ğŸ› Logging diagnÃ³stico para depuraciÃ³n de user_id en producciÃ³n

**EstadÃ­sticas:**
- ğŸ“Š 28 archivos modificados/creados (incluye hotfixes)
- ğŸ“ 5,500+ lÃ­neas aÃ±adidas
- ğŸ§ª 59 tests nuevos
- ğŸ—ƒï¸ 24+ funciones SQL nuevas
- ğŸ› 3 bugs crÃ­ticos resueltos en producciÃ³n

### v2.1.0 (2026-02-10) - Freemium Model âœ¨

**Nuevo:**
- ğŸ’ Modelo freemium completo (free + premium â‚¬3.99)
- ğŸ‘‘ Admin panel para VIP grants
- ğŸ” Service role key para operaciones admin
- ğŸ’³ IntegraciÃ³n Stripe (80% completa)
- ğŸ¨ Dark mode fixes en prompts premium

### v2.0.0 (2026-02-09) - AI Agent v2 ğŸ¤–

**Nuevo:**
- ğŸ§  AI Agent v2 con OpenAI Function Calling
- ğŸ“š Sistema de aprendizaje (feedback + consenso global)
- ğŸ” BÃºsqueda semÃ¡ntica con embeddings
- ğŸ¯ AdaptaciÃ³n segÃºn calidad de datos
- âš¡ 40-60% mÃ¡s rÃ¡pido que v1

**Ver changelog completo**: [CHANGELOG.md](CHANGELOG.md)

---

## ğŸ§ª Estado de Testing de Herramientas (2026-02-13)

### MetodologÃ­a de Testing
Testing sistemÃ¡tico de las **12 herramientas del Kakebo Copilot** en producciÃ³n con usuarios reales. Cada herramienta se valida exhaustivamente antes de continuar con la siguiente.

**Objetivo**: Garantizar 100% de funcionalidad antes del lanzamiento oficial.

**Progreso:** **9/12 validadas (75%)** | **13 bugs encontrados y corregidos** âœ…

ğŸ“„ **[Ver informe completo de validaciÃ³n â†’](2026-02-13-validacion-tools-produccion.md)**

---

### âœ… Herramientas Validadas (9/12)

| # | Herramienta | Estado | Bugs Corregidos | DescripciÃ³n |
|---|-------------|--------|-----------------|-------------|
| 1 | `analyzeSpendingPattern` | âœ… | 2 fixes | AnÃ¡lisis de gastos por categorÃ­a/perÃ­odo |
| 2 | `getBudgetStatus` | âœ… | 0 | Estado del presupuesto actual |
| 3 | `detectAnomalies` | âœ… | 1 fix | DetecciÃ³n de gastos inusuales |
| 4 | `predictMonthlySpending` | âœ… | 1 fix | ProyecciÃ³n de gastos fin de mes |
| 5 | `getSpendingTrends` | âœ… | 2 fixes | Tendencias histÃ³ricas de gasto |
| 6 | `searchExpenses` | âœ… | 4 fixes | BÃºsqueda semÃ¡ntica avanzada |
| 7 | `submitFeedback` | âœ… | 3 fixes | Sistema de aprendizaje continuo |
| 8 | `createTransaction` | âœ… | 0 | Crear gastos/ingresos por chat |
| 9 | `updateTransaction` | âœ… | 0 | Modificar transacciones existentes |

**Bugs crÃ­ticos corregidos:**
- ğŸ› ProyecciÃ³n mensual incorrecta (weighted â†’ linear)
- ğŸ› Tendencias confusas (meses incompletos sin proyectar)
- ğŸ› BÃºsqueda con falsos positivos (threshold demasiado bajo)
- ğŸ› FK constraint violation en submitFeedback (fixed expenses)
- ğŸ› LLM inventando IDs falsos (faltaba incluir IDs en respuestas)

---

### â³ Herramientas Pendientes de ValidaciÃ³n (3/12)

| # | Herramienta | DescripciÃ³n |
|---|-------------|-------------|
| 10 | `calculateWhatIf` | PlanificaciÃ³n de escenarios futuros |
| 11 | `setBudget` | Configurar presupuestos por chat |
| 12 | `getCurrentCycle` | Info del ciclo de pago actual |

---

### ğŸ¯ PrÃ³ximos Steps

**Inmediato (Hoy/MaÃ±ana)**:
- â³ Tool #10: `calculateWhatIf` testing
- â³ Tool #11: `setBudget` testing
- â³ Tool #12: `getCurrentCycle` testing

**Esta Semana**:
- Completar 100% de validaciÃ³n (12/12 tools)
- Crear regression test suite automatizada
- Documentar casos de uso completos
- Optimizar latencia (objetivo < 2s p95)

**Timeline estimado**: 1-2 dÃ­as para completar las 3 herramientas restantes

---

## ğŸ“ Soporte & Contacto

**Autor**: Aitor AlarcÃ³n MuÃ±oz

- ğŸ’¬ **Issues**: [GitHub Issues](https://github.com/mrsteppenwolf627/kakebo/issues)
- ğŸ“§ **Email**: [aitoralmu21@gmail.com](mailto:aitoralmu21@gmail.com)
- ğŸ“ **TelÃ©fono**: Disponible para consultas
- ğŸ“– **Docs**: [CONTEXT.md](CONTEXT.md)

---

## ğŸ“œ Licencia

**Proprietary** - Todos los derechos reservados

Â© 2026 Kakebo AI. Este software es propiedad privada y no puede ser distribuido, modificado o usado sin permiso explÃ­cito.

---

## ğŸ™ Agradecimientos

**Inspirado en:**
- ğŸ“˜ MÃ©todo Kakebo tradicional japonÃ©s
- ğŸ¨ FilosofÃ­a Wabi-Sabi
- â˜¸ï¸ Principios Zen de simplicidad

**Powered by:**
- [OpenAI](https://openai.com) - GPT-4o-mini
- [Supabase](https://supabase.com) - PostgreSQL + Auth
- [Vercel](https://vercel.com) - Deployment
- [Stripe](https://stripe.com) - Payments

---

<div align="center">

**Hecho con â¤ï¸ y ğŸ¤– AI**

**Desarrollado por**: [Aitor AlarcÃ³n MuÃ±oz](mailto:aitoralmu21@gmail.com)

[â¬† Volver arriba](#-kakebo-ai)

</div>
